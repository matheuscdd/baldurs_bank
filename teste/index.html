<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Firebase Auth + .NET</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
</head>

<body>
  <h1>Login com Firebase</h1>
  <input type="email" id="email" placeholder="Email" />
  <input type="password" id="password" placeholder="Senha" />
  <button onclick="login()">Login</button>
  <button onclick="signup()">Cadastrar</button>

  <script>
    // Firebase config do seu projeto
    let auth;
    init();
    async function init() {
      const config = await fetch('firebase.front.json');
      const firebaseConfig = await config.json();

      firebase.initializeApp(firebaseConfig);
      auth = firebase.auth();
    }

    async function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      try {
        const result = await auth.signInWithEmailAndPassword(email, password);
        const idToken = await result.user.getIdToken();
        console.log(idToken);

        // Envia o token para o backend
        const response = await fetch("http://localhost:5000/auth/check", {
          headers: {
            "Authorization": "Bearer " + idToken
          }
        });

        const data = await response.json();
        console.log("Resposta do backend:", data);
        alert("Token válido! UID: " + data.uid);
      } catch (error) {
        console.error(error);
        alert("Erro no login");
      }
    }

    async function signup() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      try {
        await auth.createUserWithEmailAndPassword(email, password);
        alert("Usuário criado com sucesso. Agora faça login.");
      } catch (error) {
        console.error(error);
        alert("Erro ao cadastrar: " + error.message);
      }
    }

  </script>
</body>

</html>